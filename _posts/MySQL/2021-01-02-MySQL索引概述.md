---
layout:     post
title:      "MySQL - 索引概述"
subtitle:   " \"MySQL Knowledge - 高级部分\""
date:       2021.01.02 12:29:00
author:     "Wuy"
header-img: "img/post-bg-2020.jpg"
catalog: true
tags:
    - 学习笔记
    - 读书
    - MySQL


---

> *"Keep Learning MySQL"*

# 索引概述

1. 索引是帮助MySQL高效获取数据的数据结构, 可以得到索引的本质:索引是一种数据结构. 索引的目的在于提高查询效率,类似于字典.
2. 数据本身之外,数据库还维护着一个满足特定查找算法的数据结构,这些数据以某种方式指向数据,这样就可以在这些数据结构的基础上实现高级查找算法,这种数据结构就是索引.
3. 索引本身也很大,不可能全部存储在内存中,因此索引往往以索引文件的形式存储在磁盘上;
4. 优势:
   - 提高了检索效率,减少了数据的IO;
   - 降低数据排序的成本你,降低了CPU的消耗
     劣势:

- 实际上索引也是一张表,该表保存了主键与索引字段,并指向实体表的记录,所以索引列也是要占空间的;
- 虽然索引大大加快了查询的速度,但也会降低更新表的速度.因为更新表的时候,MySQL不仅要保存数据,还要保存一下索引文件每次更新添加了索引列的字段,都会调整因为更新所带来的键值变化后的索引信息;
- 如果数据量较大,那么需要研究如何创建优秀的索引,或优化查询方法

## 索引分类

1. 单值索引

   即一个索引只包含单个列,一个表可以有多个单列索引.

2. 唯一索引

   索引列的值必须唯一,但允许空值

3. 复合索引

   即一个索引包含多个列.

4. 基本语法

- 创建: `create (unique) index indexName on mytable(columnname(length));`或者`alter table add (unique) indexName on (columnname(length))`
- 删除: `drop index (indexName) on mytable`
- 查看: `show index from table_name`

5. 索引结构：BTree 索引

## 创建索引的情况

1. 主键自动建立唯一索引；
2. 频繁作为查询条件的字段应该创建索引；
3. 查询中与其他表关联的字段，外键关系建立索引；
4. 频繁更新的字段不适合创建索引；
5. `where`条件里用不到的字段不创建索引；
6. 在高并发条件下倾向创建组合索引；
7. 查询中排序的字段，排序字段若通过索引去访问将大大提高排序速度。
8. 查询中统计或分组字段。

## 不创建索引的情况

1. 表记录数据过少；
2. 经常增删改的表；
3. 如果某个数据列包含许多重复的内容，为它建立索引就没有太大意义。

## 索引性能分析

1. MySQL的常见瓶颈：

   - CPU：CPU在饱和的时候一般发生在数据装入内存或从磁盘上读取数据的时候；
   - IO：磁盘I/O瓶颈发生在装入数据远大于内存容量的时候；
   - 服务器硬件的性能瓶颈：`top`,`free`,`iostat`或`vmstat`来查看系统的性能状态。

2. `Explain`的用法

   - 使用`Explain`关键字可以模拟优化器执行SQL查询语句，从而指导MySQL是如何处理你的SQL语句的。分析你的查询语句或者是表结构的性能瓶颈。

   - 作用主要包括：

     - 表的读取顺序；
     - 数据读取操作的数据类型；
     - 哪些索引可以使用；
     - 哪些索引实际被使用；
     - 表之间的引用；
     - 每张表有多少行被优化器查询

   - 执行计划包含的信息：

     ![image-20210103164250627](https://i.loli.net/2021/01/03/tBhiUmfFnIezHVy.png)

     - `id`: `id`相同的情况下, 执行顺序由上往下; 如果是子查询, `id`会递增, 且`id`越大的优先级越高;`table`字段里的`derived%d`里面的`%d`代表衍生执行`id`;
     - 








































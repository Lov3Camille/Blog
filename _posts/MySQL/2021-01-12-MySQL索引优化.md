---
layout:     post
title:      "MySQL - 索引优化"
subtitle:   " \"MySQL Knowledge - 高级部分\""
date:       2021.01.12 12:29:00
author:     "Wuy"
header-img: "img/post-bg-2020.jpg"
catalog: true
tags:
    - 学习笔记
    - 读书
    - MySQL



---

> *"Keep Learning MySQL"*

# 索引优化

1. 单表索引

   这里的关键点在于复合索引中的后一个索引能否根据前一个索引检索到，如果不可以，执行`explain`则会发现`Extra`字段里出现了`using filesort`，这是需要避免的；

2. 双表索引

   `left join`的话，需要对右表建索引，`right join`则相反，因为被连接的那个表一定是有缺失值的。
   
3. 多表索引

   索引最好设置在需要经常查询的字段中（也就是左连接和右连接常用的字段）。

4. 几条原则：

   - 尽可能减少`join`语句中的循环总次数（小结果集驱动大结果集）；
   - 优先优化内层循环；
   - 保证`join`语句中被驱动表上的`join`条件字段已被索引；
   - 在建索引的前提下，不要吝啬`joinbuffer`的设置。

## 索引失效

1. 全值匹配最优；
2. 最左匹配原则（依此匹配，不能断层）；
3. 不在索引列上做任何的操作（计算、函数、（自动或手动）类型转换），会导致索引失效而转向全表扫描；
4. 存储引擎无法做到使用索引中范围条件右边的索引列；
5. 尽量使用覆盖索引（只访问左营的查询（索引列和查询列一致）），减少`select *`;
6. MySQL使用不等于（`!=/<>`）的时候无法使用索引会导致全表扫描;
7. `is null`和`is not null`也无法使用索引；
8. `like`以通配符开头（‘`%abc...`’），MySQL索引失效会编程全表扫描的操作，最好把百分号放在右边；
   - 通配符放右边相当于范围查找，与范围条件一样，它会导致下一个索引失效；
   - 对于双端都有通配符的情况，使用覆盖索引就可以解决。
9. 字符串不加单引号索引失效；
10. 少用`or`，用它来连接时会索引失效。

